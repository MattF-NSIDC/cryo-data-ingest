name: "test"
on: ["push"]
jobs:
  # TODO: How to split environment setup and test steps into different jobs?
  test:
    defaults:
      run:
        shell: "bash -l {0}"

    runs-on: "ubuntu-latest"
    steps:
      - uses: "actions/checkout@v3"

      - name: "Create conda environment"
        uses: "conda-incubator/setup-miniconda@v2"
        with:
          environment-file: "environment.yml"
          activate-environment: "cryo-data-ingest"
          miniforge-version: "latest"
        # TODO: Do we need the `setup-miniconda` action? Why not:
        # run: "conda env create"

      - name: "Run static analysis / tests"
        run: "inv test.ci"
